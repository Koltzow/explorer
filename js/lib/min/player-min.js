var Player={},Smoke={particles:[],l:30,s:3,c:["rgba(0,0,0,0.5)"]};Horizon.player=Player,Smoke.add=function(i,t){var s=2*Math.random()*Math.PI,e=Math.random()*this.s,h=this.l;this.particles.push({x:i,y:t,l:h,r:e,c:this.c[Math.floor(Math.random()*this.c.length)]})},Smoke.update=function(){for(var i=0;i<this.particles.length;i++)this.particles[i].l--,this.particles[i].r+=Math.random(),this.particles[i].y+=.5,this.particles[i].c="rgba(255, 255, 255, "+1/this.l*this.particles[i].l+")",this.particles[i].l<0&&this.particles.splice(i,1)},Smoke.draw=function(){if(this.particles.length<1)return!1;for(var i=0;i<this.particles.length;i++)Engine.ctx.fillStyle=this.particles[i].c,Engine.ctx.fillRect(this.particles[i].x+Engine.width/2-Camera.x-this.particles[i].r/2,this.particles[i].y+Engine.height/2-Camera.y-this.particles[i].r/2,this.particles[i].r,this.particles[i].r)},Player.create=function(i){i=i||{};var t={};return t.controllable=i.controllable||!1,t.id="player",t.x=i.x||0,t.y=i.y||0,t.z=i.z||0,t.vz=0,t.shield=100,t.maxShield=100,t.health=50,t.maxHealth=100,t.speed=5,t.width=i.width||32,t.height=i.height||32,t.dir=[0,1],t.history=[],t.maxHistory=20,t.step=!1,t.walking=!1,t.jumping=!1,t.footsteps=new Image,t.footsteps.src="images/tilesheets/characters/footsteps.png",t.shadow=new Image,t.shadow.src="images/tilesheets/characters/shadow.png",t.tilesheet=new Image,t.tilesheet.src="images/tilesheets/characters/player.png",t.animations={idle:{right:{x:0,y:0,f:1,s:1},down:{x:1,y:0,f:1,s:1},left:{x:2,y:0,f:1,s:1},up:{x:3,y:0,f:1,s:1}},walking:{right:{x:0,y:1,f:4,s:2},downright:{x:0,y:2,f:4,s:2},down:{x:0,y:3,f:4,s:2},downleft:{x:0,y:4,f:4,s:2},left:{x:0,y:5,f:4,s:2},upleft:{x:0,y:6,f:4,s:2},up:{x:0,y:7,f:4,s:2},upright:{x:0,y:8,f:4,s:2}},flying:{right:{x:0,y:9,f:4,s:2}}},t.currentAnimation=t.animations.idle.down,t.currentAnimationFrame=0,t.update=function(){if(this.walking=!1,this.controllable){var i={x:0,y:0},t=!1;(Keyboard.isPressed("w")||Keyboard.isPressed("ArrowUp"))&&(i.y-=1),(Keyboard.isPressed("s")||Keyboard.isPressed("ArrowDown"))&&(i.y+=1),(Keyboard.isPressed("a")||Keyboard.isPressed("ArrowLeft"))&&(i.x-=1),(Keyboard.isPressed("d")||Keyboard.isPressed("ArrowRight"))&&(i.x+=1),Touch.enabled&&(i=Touch.dir),0!==i.x||0!==i.y?(this.walking=!0,i.x>0&&0==i.y?this.currentAnimation=this.animations.walking.right:i.x>0&&i.y>0?(this.currentAnimation=this.animations.walking.downright,t=3):0==i.x&&i.y>0?this.currentAnimation=this.animations.walking.down:i.x<0&&i.y>0?(this.currentAnimation=this.animations.walking.downleft,t=3):i.x<0&&0==i.y?this.currentAnimation=this.animations.walking.left:i.x<0&&i.y<0?(this.currentAnimation=this.animations.walking.upleft,t=3):0==i.x&&i.y<0?this.currentAnimation=this.animations.walking.up:i.x>0&&i.y<0&&(this.currentAnimation=this.animations.walking.upright,t=3),this.dir=i,this.x+=this.dir.x*(t||this.speed),this.y+=this.dir.y*(t||this.speed)):this.dir.y>0?this.currentAnimation=this.animations.idle.down:this.dir.y<0?this.currentAnimation=this.animations.idle.up:this.dir.x>0?this.currentAnimation=this.animations.idle.right:this.currentAnimation=this.animations.idle.left}Keyboard.isPressed("Space")&&JetfuelBar.target>0&&(this.vz-=1.5,this.flying=!0,JetfuelBar.target-=.005,Smoke.add(this.x,this.y-this.z+10)),this.vz+=1,this.z-=this.vz,this.z<0?(this.flying=!1,this.z=0,this.vz=0):this.z>80&&(this.z=80,this.vz=0),this.flying&&(this.walking=!1,this.currentAnimation=this.animations.flying.right),this.currentAnimationFrame+=1/this.currentAnimation.s,this.currentAnimationFrame>=this.currentAnimation.f&&(this.currentAnimationFrame=0);for(var s=0;s<Engine.bodies.length;s++)Engine.bodies[s]!==this&&Collision.test(this,Engine.bodies[s])&&this.z<32&&void 0!==Engine.bodies[s].activate&&Engine.bodies[s].activate(this);var e=this.x,h=this.y;this.history[0]!==""+e+":"+h&&this.walking&&(this.history.unshift(e+":"+h),this.maxHistory<this.history.length&&this.history.pop()),HealthBar.target=this.health/this.maxHealth,Shield.target=this.shield/this.maxShield,Smoke.update()},t.render=function(){for(var i=1;i<this.history.length;i++){var t=this.history[i].split(":");Engine.ctx.drawImage(this.footsteps,32*(i+this.step),0,32,32,Math.round(parseFloat(t[0])+Engine.width/2-16-Camera.x),Math.round(parseFloat(t[1])+Engine.height/2-16-Camera.y),this.width,this.height)}this.walking&&(this.step=!this.step),this.flying&&Engine.ctx.drawImage(this.shadow,0,0,32,32,Math.round(this.x+Engine.width/2-this.width/2-Camera.x),Math.round(this.y+Engine.height/2-this.height/2-Camera.y),32,32),Smoke.draw(),Engine.ctx.drawImage(this.tilesheet,(this.currentAnimation.x+Math.floor(this.currentAnimationFrame))*this.width,this.currentAnimation.y*this.height,this.width,this.height,Math.round(this.x+Engine.width/2-this.width/2-Camera.x),Math.round(this.y-this.z+Engine.height/2-this.height/2-Camera.y),this.width,this.height)},t};