var Engine={};Horizon.engine=Engine,Engine.create=function(i,t){var e=this;t=t||{},this.seed=i||"1",document.body.style.backgroundColor="#111",this.container=document.createElement("div"),this.container.id="canvas-container",this.container.style.height=window.innerHeight+"px",this.container.style.width=window.innerWidth+"px",this.container.style.display="table";var n=document.createElement("div");n.id="cavnas-container-inner",n.style.display="table-cell",n.style.verticalAlign="middle",this.container.appendChild(n),document.body.appendChild(this.container),this.mainloop=null,this.bodies=[],this.stopped=!0,this.fullscreen=t.fullscreen||!0,this.width=640,this.height=360,this.backgroundColor=t.backgroundColor||"#03a9f4",this.fps=t.fps||30,this.camera=t.camera||{x:0,y:0},this.canvas=document.createElement("canvas"),this.canvas.style.margin="0 auto",this.canvas.width=this.width,this.canvas.height=this.height;var h,s;this.fullscreen?this.width/this.height<window.innerWidth/window.innerHeight?(h=this.width/this.height*window.innerHeight,s=window.innerHeight):(h=window.innerWidth,s=this.height/this.width*window.innerWidth):(h=this.width,s=this.height),this.canvas.style.width=h+"px",this.canvas.style.height=s+"px",n.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(i){window.setTimeout(i,1e3/e.fps)}}(),this.now=Date.now(),this.then=Date.now(),this.interval=1e3/this.fps,this.delta=0,window.addEventListener("resize",this.resize.bind(this)),Keyboard.addKeyPressListener("Escape",function(){e.stopped&&RotateDevice.valid?e.run():e.stop()})},Engine.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},Engine.update=function(){this.bodies.sort(function(i,t){return i.y+i.height>t.y+t.height});for(var i=0;i<this.bodies.length;i++)this.bodies[i].update();Shield.update(),HealthBar.update(),JetfuelBar.update(),void 0!==Camera.target&&Camera.update()},Engine.render=function(){this.clear(),Planet.render();for(var i=0;i<this.bodies.length;i++)this.bodies[i].render();Shield.render(),HealthBar.render(),JetfuelBar.render(),Touch.render()},Engine.add=function(i){this.bodies.push(i)},Engine.resize=function(){var i,t;this.container.style.height=window.innerHeight+"px",this.container.style.width=window.innerWidth+"px",this.fullscreen?this.width/this.height<window.innerWidth/window.innerHeight?(i=this.width/this.height*window.innerHeight,t=window.innerHeight):(i=window.innerWidth,t=this.height/this.width*window.innerWidth):(i=this.width,t=this.height),this.canvas.style.width=i+"px",this.canvas.style.height=t+"px",this.render()},Engine.loop=function(){this.mainloop=requestAnimFrame(this.loop.bind(this)),this.now=Date.now(),this.delta=this.now-this.then,this.delta>this.interval&&(this.then=this.now-this.delta%this.interval,this.update(),this.render())},Engine.run=function(){var i=this;console.log("RUN"),this.stopped&&(this.loop(),this.stopped=!1)},Engine.stop=function(){this.stopped||(console.log("STOP"),window.cancelAnimationFrame(this.mainloop),this.render(),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.width,this.height),this.stopped=!0)};